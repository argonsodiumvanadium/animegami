const $mal_api_URL="https://api.jikan.moe/v3/";var $path,urlParams,$anime_data={};function $(t){return document.getElementById(t)}function gen(t){return document.createElement(t)}function getURLParameters(){(window.onpopstate=function(){var t,a=/\+/g,n=/([^&=]+)=?([^&]*)/g,e=function(t){return decodeURIComponent(t.replace(a," "))},s=window.location.search.substring(1);for(urlParams={};t=n.exec(s);)urlParams[e(t[1])]=e(t[2])})()}render=t=>{window.open("mainpage.html?loc="+t,"_self")},fetch_path_from_MAL_API=async t=>{var a={};return await fetch($mal_api_URL+t).then(t=>t.json()).then(t=>a=t).catch(t=>console.log(t)),a},displayData=async t=>{$("anime-name").textContent=t.title,$("image-holder").src=t.image_url,$("synopsis").textContent=t.synopsis.replace("[Written by MAL Rewrite]",""),score=parseFloat(t.score),col=getScoreClass(score),para_class="has-text-"+col,progress_class="is-"+col,$("mal-score-numeric").classList.add(para_class),$("mal-score").classList.add(progress_class),$("mal-score-numeric").textContent=score+"/10",$("mal-score").setAttribute("value",""+10*score),loadDataIntoInfoElem(t),"anime"==urlParams.type?loadAnimeData(t):loadMangaData(t)},loadAnimeData=t=>{tag_studio_licensor_data=load_Tag_Studio_and_licensorData(t),anime_additional_data=`<br>\n\t\t type   : ${t.type}<br>\n\t\t source : ${t.source}<br><br>\n\n\t\t<div class="navbar-divider"></div><Br>\n\n\t\t${tag_studio_licensor_data}<br><Br>\n\t\t\n\t\t<div class="navbar-divider"></div><Br>\n\t\t\n\t\tscore    : <span class="${para_class}}">${t.score}</span><br>\n\t\trating   : ${t.rating}<br>\n\t\tduration : ${t.duration}<br><br>\n\n\t\t<div class="navbar-divider"></div><br>\n\n\t\trank       : ${t.rank}<br>\n\t\tpopularity : ${t.popularity}<br><br>\n\t\t\n\t\t<div class="navbar-divider"></div><br>\n\t\t\n\t\tpremiered  : ${t.premiered}<br>\n\t\tbroadcast  : ${t.broadcast}<br>\n\t\tstatus     : ${t.status}<br><br>\n\n\t\t<div class="navbar-divider"></div><br>\n\n\t\toriginal name : ${t.title_japanese}<br>\n\t\tother names   : ${t.title_synonyms.join(", ")}<br><br>\n\n\t\t<div class="navbar-divider"></div><br>\n\t\t<div class="button is-link is-outlined is-fullwidth" onclick="window.open('${t.url}')">go to MAL</div>\n\t`,$("additional-data").innerHTML=anime_additional_data,"manga"!=t.source.toLowerCase()&&($("manga-tab").className+=" disabled ",$("manga-tab").children[0].className+=" asv-disabled ")},loadMangaData=t=>{for(genre of(genres='<h1 class="py-2">Genres :',t.genres))genres+=`\n\t\t\t<span class="has-text-info" style="display:inline-block;">\n\t\t\t\t${genre.name}\n\t\t\t</span>, \n\t\t`;genres+="</h1>",manga_additional_data=`\n\t<br>\n\t\t type   : ${t.type}<br>\n\n\t\t${genres}\n\t\t\n\t\tscore    : <span class="${para_class}}">${t.score}</span><br><br>\n\n\t\t<div class="navbar-divider"></div><br>\n\n\t\trank       : ${t.rank}<br>\n\t\tpopularity : ${t.popularity}<br><br>\n\t\t\n\t\t<div class="navbar-divider"></div><br>\n\t\t\n\t\tvolumes     : ${t.volumes}<br>\n\t\tchapters    : ${t.chapters}<br>\n\t\tpublishing  : ${t.publishing?'<span class="has-text-success">yes</span>':'<span class="has-text-danger">no</span>'}<br><br>\n\n\t\t<div class="navbar-divider"></div><br>\n\n\t\toriginal name : ${t.title_japanese}<br>\n\t\tother names   : ${t.title_synonyms.join(", ")}<br><br>\n\n\t\t<div class="navbar-divider"></div><br>\n\t\t<div class="button is-link is-outlined is-fullwidth" onclick="window.open('${t.url}')">go to MAL</div>\n\t`,$("additional-data").innerHTML=manga_additional_data,$("anime-tab").className+=" disabled ",$("anime-tab").children[0].className+=" asv-disabled "},load_Tag_Studio_and_licensorData=t=>{for(genre of(genres='<h1 class="py-2">Genres :',t.genres))genres+=`\n\t\t\t<span class="has-text-info" style="display:inline-block">\n\t\t\t\t${genre.name}\n\t\t\t</span>, \n\t\t`;for(studio of(genres+="</h1>",studios='<h1 class="py-2">Studios :',t.studios))studios+=`\n\t\t\t<div class="has-text-info" style="display:inline-block;">\n\t\t\t\t${studio.name}\n\t\t\t</div>, \n\t\t`;for(licensor of(studios+="</h1>",licensors="<h1> Licensors",t.licensors))licensors+=`\n\t\t\t<div class="has-text-info" style="display:inline-block;">\n\t\t\t\t${licensor.name}\n\t\t\t</div>, \n\t\t`;return licensors+="</h1>",genres+studios+licensors},loadDataIntoInfoElem=async t=>{$("info-data").innerHTML=`\n\t\t${createShowcaseForRelatedAnime(t)}\n\t\t<br><h1 class="title pt-3 pb-2 has-text-white">Some background about this anime</h1>${t.background}\n\t`},createShowcaseForRelatedAnime=t=>{for(key of(showcase="",Object.keys(t.related))){for(el of(showcase+=`<br><span class="title has-text-white">${key}</span><br>`,t.related[key]))showcase+=`\n\t\t\t\t<div class="my-3 py-3 px-3" onclick="window.open('watch.html?id=${el.mal_id}&type=${el.type}')" \n\t\t\t\tstyle="backdrop-filter:blur(8px);background-color: rgba(255,255,255,0.05);display:inline-block;cursor:pointer"\n\t\t\t\t mal_id="${el.mal_id}">\n\t\t\t\t\t${el.name}\n\t\t\t\t</div>\n\t\t\t`;showcase+="<br>"}return showcase},getScoreClass=t=>t>7.5?"success":t>5?"warning":"danger",init=async()=>{getURLParameters(),M.AutoInit(),$path=urlParams.type+"/"+urlParams.id,$anime_data=await fetch_path_from_MAL_API(urlParams.type+"/"+urlParams.id),displayData($anime_data),fetchAnimeEpisodes($anime_data),$("manga-num").onkeydown=function(t){"13"==t.keyCode&&window.open($manga_url+this.value)},$("anime-num").onkeydown=function(t){"13"==t.keyCode&&window.open($anime_url+this.value)};M.Tabs.init($("tabs"))},init();